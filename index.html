<!doctype html>
<html>

<head>
  <title>Tron wanna-be</title>
  <style>
    body {
      overflow: hidden;
    }

    /* canvas {
      width: 800px;
      height: 800px;
      border: 2px solid black;
    } */
  </style>
</head>

<body>
  <!-- <canvas id="canvas"></canvas> -->
  <script src="/socket.io/socket.io.js"></script>
  <script>


    GameCanvas = (function () {
      /*
        Constructor
      */
      function GameCanvas(canvas) {
        var ratio = window.innerWidth < window.innerHeight ?
          window.innerWidth : window.innerHeight;
        this.canvas = canvas;
        this.canvas.width = this.canvas.height = ratio;
        this.context = this.canvas.getContext('2d');
        this.gridSize = 80;
        this.cellSize = ratio / this.gridSize;
      }

      GameCanvas.prototype.draw = function (state) {
        var context = this.context;
        var cellSize = this.cellSize;

        // Render background
        this.context.fillStyle = "#fff";
        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);

        state.players.forEach((p) => {
          context.fillStyle = p.color;
          context.fillRect(p.x * cellSize, p.y * cellSize, cellSize, cellSize);
        });

        state.obstacles.forEach((o) => {
          context.fillStyle = o.color;
          context.fillRect(o.x * cellSize, o.y * cellSize, cellSize, cellSize);
        });
      }

      return GameCanvas;
    })();

    var socket = io();
    // var canvas = document.getElementById('canvas');
    var canvas = document.createElement("canvas");
    document.body.appendChild(canvas);

    var game = new GameCanvas(canvas);

    document.onkeydown = (ev) => {
      socket.emit('key', ev.keyCode);
    }

    socket.on('state', (data) => {
      // todo remove
      console.log(JSON.stringify(data));

      game.draw(data);
    });

  </script>
</body>

</html>
